<div align="center">

<h1 align="center">
<img src="./docs/imgs/folder-markdown-open.svg" width="100" />
<br>
genstudio_chatbot-main
</h1>
<h3 align="center">üìç None</h3>
<h3 align="center">‚öôÔ∏è Developed with the software and tools below:</h3>

## üìö Table of Contents
<div style="text-align: left;">

 [üìç Overview](#-overview)
 <br>
 [üí´ Features](#-features)
 <br>
 [üìÇ Project Structure](#project-structure)
 <br>
 [üß© Modules](#modules)
 <br>
 [üß© Entities and Relationships](#ERD)

 </div>

---


## üìç Overview

None

---

## üí´ Features

None

---


<img src="https://raw.githubusercontent.com/PKief/vscode-material-icon-theme/ec559a9f6bfd399b82bb44393651661b08aaf7ba/icons/folder-github-open.svg" width="80" />

## üìÇ Project Structure



<pre style="text-align: left;">
.
|-- Technical materials
|   |-- SQL
|   |   |-- O-Reilly-SQL-Cookbook-2nd-Edition-Final.pdf
|   |   |-- SQL faq.pdf
|   |   |-- SQL_Guide__1695640926.pdf
|   |   `-- celkos-sql-for-smarties-2005.pdf
|   |-- DataEngineering_Ref_links.pdf
|   `-- Pyspark interview questions.pdf
`-- wetransfer_plot-no-291_2023-05-17_1036.pdf
</pre>



---


---

<img src="https://raw.githubusercontent.com/PKief/vscode-material-icon-theme/ec559a9f6bfd399b82bb44393651661b08aaf7ba/icons/folder-src-open.svg" width="80" />

## üß© Modules

<details closed><summary>Root</summary>

| File                            | Summary                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Module                            |
|:--------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------|
| base.py                         | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'                                                                                                                                                                                                                                                                                                                                                                                                | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | base.py                           |
|                                 | For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                   |
| conf.py                         | This code snippet contains the configuration settings for an Azure OpenAI API. It includes the URL for the API endpoint, the base URL, a permanent token for authentication, client ID and secret, IMS organization ID, model name, LLM type, temperature, and token count. Additionally, it includes the hostname, port, Databricks token, database name, and HTTP path for SQL queries.                                                                                                                                             | The code snippet provided is a configuration file for an Azure OpenAI API integration. It sets various variables that are used to configure the API connection and define the behavior of the API calls.Libraries used:-No libraries are used in this code snippet. It is a simple configuration file that sets variables.Variables and their purpose:-`url`: The URL endpoint for the API call to generate chat completions.-`base_url`: The base URL for the API.-`permanent_token`: A long-lived access token used for authentication with the API.-`client_id`: The client ID for the API authentication.-`client_secret`: The client secret for the API authentication.-`IMS_ORG_ID`: The organization ID for the Adobe IMS.-`model_name`: The name of the model to be used for chat completions.-`llm_type`: The type of language model to be used (in this case, "azure_chat_openai").-`temperature`: The temperature parameter for generating chat completions. A higher value (e.g., 1.0) makes the output more random, while a lower value (e.g., 0.0) makes it more deterministic.-`tokens`: The maximum number of tokens allowed in the generated chat completion.-`hostname`: The hostname for the Azure Databricks instance.-`port`: The port number for the Azure Databricks instance.-`dbx_token`: The access token for the Azure Databricks instance.-`db`: The name of the database to be used in the Azure Databricks instance.-`http_path`: The HTTP path for the API call to execute SQL queries in the Azure Databricks instance.Overall, this code snippet sets up the necessary configuration variables for connecting to the Azure OpenAI API and the Azure Databricks instance, allowing for chat completions and SQL queries to be executed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | conf.py                           |
| exceptions.py                   | The provided code snippet defines five custom exception classes: DependencyError, ConnectionError, ExecutionError, ValidationError, and APIError. These exceptions are raised in specific scenarios: when there are missing dependencies, connection issues, execution failures, validation errors, or API errors, respectively. These custom exception classes allow for more specific and meaningful error handling in the code.                                                                                                    | The code snippet provided defines a set of custom exception classes. These exception classes are used to raise specific types of errors in a program.Here is a breakdown of each exception class:1. DependencyError(Exception): This exception is raised when there are missing dependencies in the program. It is a custom exception class that inherits from the base Exception class.2. ConnectionError(Exception): This exception is raised when there is a connection error. It is a custom exception class that inherits from the base Exception class.3. ExecutionError(Exception): This exception is raised when there is an error in executing code. It is a custom exception class that inherits from the base Exception class.4. ValidationError(Exception): This exception is raised when there is a validation error. It is a custom exception class that inherits from the base Exception class.5. APIError(Exception): This exception is raised when there is an error related to an API. It is a custom exception class that inherits from the base Exception class.The purpose of defining these custom exception classes is to provide more specific and meaningful error messages when certain types of errors occur in the program. By raising these custom exceptions, the program can handle different types of errors in a more granular way and provide appropriate error handling and messaging.The code snippet does not include any specific logic or functions. It only defines the custom exception classes. Therefore, there are no libraries used in this code snippet.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | exceptions.py                     |
| firefall.py                     | The provided code snippet defines a class called "FirefallOpenAI" that encapsulates the functionality of interacting with an OpenAI model. It includes methods for submitting prompts to the model and retrieving the generated output. The class initializes various parameters such as temperature, max tokens, presence penalty, and more. It also handles authentication and makes HTTP requests to the OpenAI API. The code includes commented out sections that provide alternative ways of handling the response from the API. | The code snippet provided is a part of a Python class called `FirefallOpenAI`. This class is used to interact with an OpenAI API called Firefall. Let's go through the code and understand its purpose and logic.Libraries used:-`os`: This library provides a way to interact with the operating system.-`requests`: This library is used to send HTTP requests to the Firefall API.-`json`: This library is used to work with JSON data.-`asyncio`: This library is used for asynchronous programming.-`base`: This is a custom module that contains some base functionality.-`cachetools`: This library provides caching functionality.-`utils`: This is a custom module that contains some utility functions.-`conf`: This is a custom module that contains configuration variables.The `FirefallOpenAI` class has the following attributes:-`temperature`: A float value representing the temperature parameter for generating text.-`max_tokens`: An integer representing the maximum number of tokens to generate.-`streaming`: A boolean indicating whether to use streaming or not.-`cache`: An instance of `TTLCache` class from the `cachetools` library, used for caching responses.-`endpoint`: A string representing the URL of the Firefall API.-`model_name`: A string representing the name of the model to use.-`firefall_token`: A string representing the permanent token for authentication.-`client_id`: A string representing the client ID for authentication.-`client_secret`: A string representing the client secret for authentication.-`IMS_ORG_ID`: A string representing the IMS organization ID for authentication.-`llm_type`: A string representing the language model type.-`token_data`: A string representing the generated token for authentication.-`top_p`: A float value representing the top-p parameter for generating text.-`frequency_penalty`: An integer representing the frequency penalty parameter for generating text.-`presence_penalty`: A float value representing the presence penalty parameter for generating text.-`n`: An integer representing the number of completions to generate.The `submit_prompt` method is used to send a prompt to the Firefall API and receive a response. It takes a `prompt` parameter, which is a list of messages. The method first checks if the prompt is not None and not empty. Then, it calculates the number of tokens in the prompt by counting the number of characters in each message and dividing by 4 (approximation for the number of characters per token).The method then prepares the headers and payload for the API request. The headers include the authentication token and other required headers. The payload includes the prompt messages and various parameters for generating text.The method sends a POST request to the Firefall API using the `requests` library. It passes the headers, payload, and streaming parameter. The response is stored in the `response` variable.There are three different blocks of commented code in the method. These blocks seem to be alternative implementations or different ways of handling the response from the Firefall API. The first block seems to be a simple way of extracting the generated text from the response and returning it. The second block seems to be a way of using streaming to receive the generated tokens from the response. The third block seems to be a combination of the first and second blocks, where the generated tokens are concatenated into a final output string and yielded one by one.Finally, if the response status code is 200 (indicating a successful request), the method returns the generated tokens one by one using the `yield` keyword. If the response status code is not 200, an exception is raised with the error details.In summary, the purpose of this code is to provide a class `FirefallOpenAI` that interacts with the Firefall API to generate text based on a given prompt. The `submit_prompt` method sends a prompt to the API and receives the generated text as a response. The method provides different ways of handling the response, including streaming and concatenating the generated tokens.                                                                                                                                                                                                                                                                                                      | firefall.py                       |
| genstudio_chat_rag_test.ipynb   | Prompt exceeds max token limit: 6785                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Prompt exceeds max token limit: 6778                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | genstudio_chat_rag_test.ipynb     |
| genstudio_chat_test.ipynb       | Prompt exceeds max token limit: 5910                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Prompt exceeds max token limit: 5903                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | genstudio_chat_test.ipynb         |
| genstudio_data_copy_dbx.ipynb   | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'                                                                                                                                                                                                                                                                                                                                                                                                | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | genstudio_data_copy_dbx.ipynb     |
|                                 | For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                   |
| genstudio_schema_creation.ipynb | Prompt exceeds max token limit: 7923                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Prompt exceeds max token limit: 7916                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | genstudio_schema_creation.ipynb   |
| main.py                         | This code snippet is a Streamlit application that serves as a chatbot powered by the Firefall OpenAI model. It allows users to ask questions about GenStudio insights data and generates responses based on the classification of the question. The chat history is displayed, and if the last message is not from the assistant, a new response is generated by generating SQL queries, running them on Databricks, and displaying the results along with a summary.                                                                 | The purpose of this code is to create a chatbot interface using the Streamlit library. The chatbot is powered by the FirefallOpenAI model and is designed to answer questions about GenStudio insights data.The code begins by importing the necessary libraries: streamlit, qa_base, ChromaDBWrapper, FirefallOpenAI, and datetime. These libraries are used for creating the chatbot interface, interacting with the GenStudio data, and managing the chat history.The `main()` function is the entry point of the code. It sets the page configuration, defines a cached resource for the FirefallOpenAI model, initializes the chatbot components, and creates the sidebar with a title and welcome message.The code then checks if the chat history and context variables are present in the session state. If not, they are initialized as empty lists.Next, the code prompts the user for input using the `st.chat_input()` function and saves the user's question to the chat history.The code then iterates over the chat history and displays the prior chat messages using the `st.chat_message()` function. If the message is from the assistant, it checks if there is a query associated with the message. If there is no query, it displays the content of the message as markdown. If there is a query, it displays the query as code, followed by a table of data and a summary.After displaying the prior chat messages, the code checks if the last message is from the assistant. If not, it generates a new response. It first classifies the user's question as either "general" or not. If it is a general question, it generates a response using the `general_summary()` function from the `qa_base` class and adds it to the chat history.If the question is not general, the code performs semantic search using the `chroma_rag` object to find relevant documents. It then extracts table names from the documents and retrieves DDL (Data Definition Language) for those tables. It attempts to generate an SQL query using the `generate_sql()` function from the `qa_base` class, passing in the user's question, the semantic search results, DDL results, and the chat context. If the query contains a "select" statement, it runs the query on a Databricks cluster using the `run_sql()` function and displays the resulting data in a table. It then generates a summary using the `generate_summary()` function and adds the response, query, data, and summary to the chat history.If an error occurs during query generation or execution, the code retries a maximum of three times before raising a RuntimeError.Finally, the `main()` function is called to start the chatbot interface.The libraries used in this code are:-Streamlit: Used for creating the chatbot interface.-qa_base: A custom module that provides base functionality for the chatbot, such as generating SQL queries and summaries.-ChromaDBWrapper: A custom module that wraps the ChromaDB library for interacting with the GenStudio data.-FirefallOpenAI: A custom module that provides the FirefallOpenAI model for generating responses.-datetime: Used for working with dates and times.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | main.py                           |
| manage_rag_db.py                | This code snippet is a command-line tool for managing a Chroma DB used in a GenStudio knowledge base. It uses argparse to parse command-line arguments, allowing the user to reset the database or populate it with data. The code also includes functionality to add documentation to the database. If no action is specified, the tool provides instructions on how to use it.                                                                                                                                                      | The purpose of this code is to manage a Chroma DB for the GenStudio knowledge base. It provides functionality to reset the database, populate it with data, and add documentation.The code uses the following libraries:-argparse: This library is used to parse command-line arguments and generate help messages.-rag_db.ChromaDBWrapper: This is a custom module that provides a wrapper around the Chroma DB, allowing for easy initialization, population, and documentation management.The main function is the entry point of the code. It first sets up the argument parser with two optional arguments:--reset and--populate. These arguments are used to specify whether to reset the database or populate it with data, respectively.The ChromaDBWrapper is then initialized with the reset argument passed to the initialize method. This method initializes the Chroma DB and returns an instance of the ChromaDBWrapper class.Next, the code defines the paths to various files that will be used for populating the database and adding documentation.If the--populate argument is provided, the code enters the if block and proceeds to populate the database. It prints a message indicating that the database population is starting, then calls the populate_from_json method of the ChromaDBWrapper instance. This method takes in the paths to a JSON file containing DDL (Data Definition Language) statements and a JSON file containing SQL queries and their corresponding answers. It uses these files to populate the Chroma DB with data.After populating the database, the code calls the add_documentation method of the ChromaDBWrapper instance to add documentation to the database. It takes in the paths to a project summary file and an SQL instructions file. These files contain documentation for the GenStudio knowledge base.Finally, if neither the--reset nor the--populate arguments are provided, the code enters the else block and prints a message indicating that no action was specified. It suggests using--reset to reset the database or--populate to populate it.The if __name__ == "__main__" condition ensures that the main function is only executed when the script is run directly, not when it is imported as a module.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | manage_rag_db.py                  |
| rag_db.py                       | The provided code snippet defines a class called `ChromaDBWrapper` that serves as a wrapper for interacting with a ChromaDB database. The class provides functionalities for adding and retrieving question-answer pairs, DDL statements, and documentation. It also supports semantic search based on user questions and stores user interactions. Additionally, it includes methods for populating the database from JSON files and deleting collections.                                                                           | The code snippet provided is a Python class called `ChromaDBWrapper` that serves as a wrapper around a database called ChromaDB. It provides various functionalities for interacting with the database, such as adding QA pairs, adding DDL (Data Definition Language) statements, performing semantic search, retrieving documentation, storing user interactions, and more.Libraries used:-`base.qa_base`: It is assumed to be a custom module that provides a base class for QA-related functionality.-`utils.Utils`: It is assumed to be a custom module that provides utility functions.-`conf`: It is assumed to be a custom module that provides configuration settings.-`chromadb`: It is a library for interacting with ChromaDB, a persistent document store.-`chromadb.config.Settings`: It is a module that provides settings for configuring ChromaDB.-`langchain.embeddings.HuggingFaceEmbeddings`: It is a library for generating embeddings using Hugging Face models.-`uuid`: It is a library for generating universally unique identifiers (UUIDs).-`pandas`: It is a library for data manipulation and analysis.-`numpy`: It is a library for numerical computing.-`os`: It is a library for interacting with the operating system.-`requests`: It is a library for making HTTP requests.-`json`: It is a library for working with JSON data.The class `ChromaDBWrapper` has the following functions:1. `__init__(self, persist_directory, collection_name, model_name)`: It is the constructor of the class. It initializes the object with the provided persist directory, collection name, and model name. It also initializes the ChromaDB client, creates or retrieves collections, and populates data from existing collections.2. `initialize(cls, persist_directory, collection_name, model_name, reset)`: It is a class method that initializes the ChromaDBWrapper object. It can also reset the collections if the `reset` parameter is set to `True`.3. `get_or_create_collection(self, name)`: It is a method that retrieves an existing collection with the given name from ChromaDB or creates a new collection if it doesn't exist.4. `_populate_from_existing(self)`: It is a method that populates the QA pairs, DDL statements, and documentation from the existing collections in ChromaDB.5. `add_qa_pair(self, question, query)`: It is a method that adds a QA pair (question and corresponding SQL query) to the QA collection in ChromaDB. It also generates an embedding for the question using the specified Hugging Face model.6. `add_ddl(self, table_name, ddl)`: It is a method that adds a DDL statement for a table to the DDL collection in ChromaDB.7. `semantic_search(self, user_question, n_results)`: It is a method that performs a semantic search on the QA collection in ChromaDB using the user's question. It returns the top `n_results` matching QA pairs.8. `get_ddl_for_tables(self, table_names)`: It is a method that retrieves the DDL statements for the specified table names from the DDL collection in ChromaDB.9. `get_documentation(self, doc_type)`: It is a method that retrieves the documentation of the specified type (project summary or SQL instructions) from the documentation collection in ChromaDB.10. `populate_from_json(self, ddl_file, qa_file)`: It is a method that loads DDL statements and QA pairs from JSON files and adds them to the respective collections in ChromaDB.11. `add_documentation(self, file_path, doc_type)`: It is a method that adds documentation of the specified type (project summary or SQL instructions) from a file to the documentation collection in ChromaDB.12. `store_user_interaction(self, user_question, sql_query, sql_result, error)`: It is a method that stores user interactions (question, SQL query, result, and error) in the user interaction collection in ChromaDB.13. `get_user_interactions(self, n_results, filter_condition)`: It is a method that retrieves stored user interactions from the user interaction collection in ChromaDB. It can also apply a filter condition to retrieve specific interactions.14. `load_json_file(file_path)`: It is a static method that loads a JSON file and returns its contents.15. `load_documentation(file_path)`: It is a static method that loads a file and returns its contents.16. `delete_collections(persist_directory, collection_name)`: It is a static method that deletes the collections with the specified names from ChromaDB. | rag_db.py                         |
| train.py                        | The provided code snippet defines a chatbot class that interacts with a question-answering system and a database. It has functionalities to save and retrieve conversation context, classify questions as general or SQL-related, generate responses based on the question type, extract table names from SQL queries, generate SQL queries, execute them on a database, and generate result summaries. The chatbot uses external modules for base functionality, database access, and natural language processing.                   | This code snippet is a part of a chatbot implementation. It includes several classes and functions to handle user queries and provide appropriate responses. Let's go through the code and understand its purpose and logic.Libraries used:-`base`: It is a module that contains the base class for the chatbot.-`rag_db`: It is a module that provides a wrapper for interacting with a database.-`firefall`: It is a module that provides functionality for interacting with an OpenAI model.-`utils`: It is a module that contains utility functions.-`conf`: It is a module that contains configuration settings.-`re`: It is a module for regular expression operations.Classes and Functions:1. `chatbot` class:-`__init__` function: Initializes the chatbot object with the provided parameters and sets up the necessary configurations and variables.-`save_context` function: Saves the user message and assistant message in the context list. It also maintains the maximum context length by removing older messages if the list exceeds the limit.-`get_context` function: Returns the context list.-`extract_table_names` function: Extracts table names from a given query string using regular expressions and returns a set of unique table names.-`classify_question` function: Classifies the question into "general" or "sql" category based on certain keywords present in the question. Returns the category as a string.-`ask` function: Takes a question as input and performs the following steps:-Prints the question.-Classifies the question using `classify_question` function.-If the question is classified as "general", it calls the `general_summary` function of the `base_class` object with the question, `about_list`, and `context` as parameters. It saves the question and response in the context and returns the response.-If the question is classified as "sql", it performs the following steps:-Performs semantic search using the `chroma_rag` object and the question. The results are stored in `qa_results`.-Extracts table names from the SQL queries in the `qa_results` using `extract_table_names` function and stores them in `table_names`.-Retrieves DDL (Data Definition Language) for the tables using the `chroma_rag` object and the table names. The results are stored in `ddl_results`.-Attempts to generate an SQL query using the `generate_sql` function of the `base_class` object with the question, `sql_qa_list`, `ddl_list`, `doc_list`, `context`, and `error_message` as parameters. If successful, it saves the question and query in the context.-Executes the SQL query using the `run_sql` function of the `base_class` object with the query, `host`, `path`, and `token` as parameters. The result is stored in `df`.-Stores the user interaction (question and query) using the `store_user_interaction` function of the `chroma_rag` object.-Generates a summary of the query result using the `generate_summary` function of the `base_class` object with the question, `df`, and `context` as parameters. It saves the question and summary in the context.-Returns a string containing the query used and the summary.Overall, this code snippet sets up a chatbot object and provides functionality to handle user queries. It uses various modules and libraries to perform tasks such as semantic search, SQL query generation, and result summarization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | train.py                          |
| utils.py                        | The provided code snippet defines a class called "Utils" that contains several utility functions. These functions include reading and loading files in different formats (such as YAML and JSON), reading multiple files from a directory, and generating a token using a client ID, client secret, and authorization code. The code also includes import statements for necessary libraries and modules.                                                                                                                             | The code snippet provided is a Python script that contains a class called `Utils` with several utility functions. Let's go through each function and explain their purpose and logic:1. `read_file(self, file_path: str, file_type: str)-> str`: This function reads a file from the given `file_path` and returns its content as a JSON string. It uses the `open` function to open the file in read mode and reads its content. If the `file_type` is'yml', it uses the `yaml.safe_load` function to parse the YAML content into a Python object. Otherwise, it reads the file content as a string. Finally, it converts the content to a JSON string using `json.dumps` and returns it.2. `load_file(self, file_path: str, file_type: str)`: This function loads a file from the given `file_path` and returns its content. It first lists all the files in the `file_path` directory that have the specified `file_type` extension. If there is only one file matching the criteria, it reads the file content and returns it. If there are multiple files, it reads each file content and appends it to a list called `documentation`. The function then returns the `documentation` list.3. `read_files(self, path: str, file_type: str)-> str`: This function reads multiple files from the given `path` directory and returns their content as a JSON string. It follows a similar logic to the `load_file` function, but instead of returning a list of file contents, it returns a JSON string representation of the `documentation` list.4. `generate_token(self, client_id, client_secret, code)`: This function generates an access token by making a POST request to a specific URL with the provided `client_id`, `client_secret`, and `code`. It sets the necessary headers for the request and sends the request using the `requests.post` function. The response is then parsed as JSON, and the access token is extracted and returned.The libraries used in this code snippet are:-`os`: Used for operating system related functions.-`yaml`: Used for parsing YAML files.-`requests`: Used for making HTTP requests.-`json`: Used for working with JSON data.-`conf`: It is assumed to be a custom module or file that contains configuration settings.-`git`: Used for interacting with Git repositories.-`re`: Used for regular expression operations.-`tiktoken`: It is assumed to be a custom module or file that contains token-related functions.-`pathlib`: Used for working with file paths.-`logger`: It is assumed to be a custom module or file that handles logging functionality.Overall, this code snippet provides utility functions for reading and loading files, generating access tokens, and working with various file types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | utils.py                          |
| base.py                         | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'                                                                                                                                                                                                                                                                                                                                                                                                | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | archive\base.py                   |
|                                 | For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                   |
| cc_paid_seg_qa_chat.ipynb       | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'                                                                                                                                                                                                                                                                                                                                                                                                | Error generating file summary. Exception: Client error '400 Bad Request' for url 'https://firefall-stage.adobe.io/v1/chat/completions'For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | archive\cc_paid_seg_qa_chat.ipynb |
|                                 | For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                   |
| firefall.py                     | The provided code snippet defines a class called "FirefallOpenAI" that extends a base class called "qa_base". It initializes various attributes and sets up a cache, endpoint, model name, and authentication tokens. The class also defines methods for sending system, user, and assistant messages, as well as a method for submitting a prompt to an OpenAI API endpoint. The prompt is sent as a JSON payload to the endpoint, and the response is parsed to extract the generated message content.                              | The code snippet provided is a Python class called "FirefallOpenAI" that is used for interacting with the OpenAI API to generate responses to user prompts. Let's go through the code and explain its purpose and logic:1. Importing Libraries:-`os`: Used for interacting with the operating system.-`requests`: Used for making HTTP requests to the OpenAI API.-`json`: Used for working with JSON data.-`base.qa_base`: A custom base class for question-answering models.-`cachetools.TTLCache`: A cache implementation with time-based expiration.-`utils.Utils`: A utility class for generating tokens and other helper functions.-`conf`: A module containing configuration variables.2. Class Definition:-`FirefallOpenAI` is defined as a subclass of `qa_base`.3. Constructor:-The constructor initializes various instance variables and sets their values based on the provided configuration.-It initializes an instance of the `Utils` class.-It sets the values for temperature, max_tokens, cache, endpoint, model_name, firefall_token, client_id, client_secret, IMS_ORG_ID, llm_type, token_data, top_p, frequency_penalty, presence_penalty, and n.4. Helper Functions:-`system_message`, `user_message`, and `assistant_message` are helper functions that return a dictionary with a specific role and content.-These functions are used to create message objects for the prompt.5. `submit_prompt` Function:-This function takes a prompt (a list of message objects) as input and returns the generated response as a string.-It first checks if the prompt is None or empty and raises an exception if so.-It then calculates the number of tokens in the prompt by summing the lengths of the content in each message and dividing by 4 (approximation for the number of characters per token).-It sets the headers for the API request, including the authorization token, API key, IMS org ID, and content type.-It creates a payload JSON object containing the prompt messages and LLN metadata (model name, temperature, max tokens, presence penalty, n, and LLN type).-It makes a POST request to the OpenAI API with the endpoint, headers, and payload.-It parses the response JSON and extracts the generated message content from the first generation in the response.-Finally, it returns the generated message content as a string.Libraries used:-`os`: Used for interacting with the operating system.-`requests`: Used for making HTTP requests to the OpenAI API.-`json`: Used for working with JSON data.-`base.qa_base`: A custom base class for question-answering models.-`cachetools.TTLCache`: A cache implementation with time-based expiration.-`utils.Utils`: A utility class for generating tokens and other helper functions.The purpose of this code is to provide a wrapper class for interacting with the OpenAI API and generating responses to user prompts using the configured model and parameters. It abstracts away the details of making API requests and handling the response, making it easier to use the OpenAI API for generating conversational responses.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | archive\firefall.py               |
| main.py                         | This code snippet is a Streamlit application that serves as a chatbot interface for answering questions about CC Paid Segmentation dashboard data. It loads a pre-trained model, initializes session state, and displays a chat interface where users can ask questions. The chat history is stored in the session state, and the assistant generates responses using the loaded model. The responses are then displayed in the chat interface.                                                                                       | This code snippet is a part of a chatbot application that uses Streamlit, a Python library for building interactive web applications. The chatbot is designed to answer questions related to CC Paid Segmentation dashboard data.The code begins by importing the necessary libraries: `streamlit`, `qa_base` from the `base` module, `Model` from the `train` module, `conf`, and `datetime`.Next, a function named `load_model()` is defined and decorated with `@st.cache_resource(ttl=3600)`. This function is responsible for loading the model used by the chatbot. The `@st.cache_resource(ttl=3600)` decorator caches the model for an hour to improve performance.The model is then loaded by calling `load_model()` and assigned to the `model` variable.The code then initializes the session state. If the "messages" key is not present in the session state, it is initialized with a default message. If the "context" key is not present, it is initialized as None.The chat interface is displayed using Streamlit's `st.title()`, `st.info()`, and `st.write()` functions. The title and information are displayed at the top of the page, providing instructions and a link to the relevant wiki page. A welcome message is also displayed.The user is prompted to type their question using `st.chat_input()`. If the user provides a prompt, it is saved in the session state's "messages" list.The prior chat messages are then displayed using a for loop and `st.chat_message()`. Each message is displayed with its role (user or assistant) and content.If the last message is not from the assistant, a new response is generated. This is done by calling the `model.ask()` method with the prompt and the current context. The response is then displayed using `st.write()` and added to the session state's "messages" list. The context is updated to "assistant" for future interactions.In summary, this code snippet sets up a chatbot interface using Streamlit and a pre-trained model to answer questions related to CC Paid Segmentation dashboard data. It handles user input, generates responses, and maintains a chat history using the session state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | archive\main.py                   |
| main_old.py                     | This code snippet is a Streamlit application for a chatbot that provides information about CC Paid Segmentation data. It uses a trained model to generate responses to user queries. The chat history is stored in the session state and displayed in the UI. The code also handles user input for starting the chat and updates the session state accordingly.                                                                                                                                                                       | This code snippet is a Streamlit application that implements a chatbot for CC Paid Segmentation. The chatbot allows users to ask questions about CC Paid Segmentation data and receive SQL query responses.Libraries used:-`streamlit`: Streamlit is a Python library used for building interactive web applications. It provides an easy-to-use API for creating UI components and handling user interactions.-`base.qa_base`: This is a custom module that contains the base functionality for the chatbot, including the question-answering logic.-`train.Model`: This is a custom module that represents the trained model used by the chatbot to generate responses.-`conf`: This is a custom module that contains configuration settings for the chatbot.The code starts by importing the necessary libraries and modules. It then defines a function `main()` that serves as the entry point for the Streamlit application.Inside the `main()` function, a `Model` object is created. The Streamlit UI is then built using various Streamlit components. The UI includes a title, an information message with a link to the CC Paid Segmentation wiki page, and a chat interface.If the user has not entered their name, a form is displayed to prompt the user to enter their name. Once the form is submitted, the user's name is stored in the Streamlit session state. The chat history is then displayed, and the `handle_chat()` function is called to handle user input and generate responses.The `handle_chat()` function takes the `model` object as a parameter. It starts by displaying a welcome message to the user. If there are no prior chat messages in the session state, an initial message from the assistant is added to the chat history.The user is prompted to enter their question using the `st.chat_input()` component. If the user enters a question, it is added to the chat history. The prior chat messages are then displayed using the `st.chat_message()` component.If the last message in the chat history is not from the assistant, the model is asked for a response. The response is then displayed as a new message from the assistant using the `st.chat_message()` component. The response is also displayed as code with line numbers using the `chatbot_message_response.code()` method.Finally, the `main()` function is called if the script is executed directly.In summary, this code snippet implements a Streamlit chatbot application for CC Paid Segmentation. It uses the Streamlit library for building the UI and handles user interactions. The chatbot logic is implemented using a trained model and a custom question-answering module.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | archive\main_old.py               |
| train.py                        | The provided code snippet defines a class called "Model" that inherits from the "FirefallOpenAI" class. It initializes various attributes such as model name, host, port, token, database, and path. It also reads SQL queries, documentation, and JSON files using utility functions. The "ask" method takes a question as input, generates a SQL query based on the question, runs the query, generates a summary of the results, and returns the query and summary as a formatted string.                                          | The purpose of this code is to define a Model class that inherits from the FirefallOpenAI class. The Model class is used to generate SQL queries, run them, and generate a summary based on the results.The code begins by importing necessary libraries: `qa_base` from the `base` module, `FirefallOpenAI` from the `firefall` module, `os`, `Utils` from the `utils` module, and `conf` for configuration settings.The `Model` class is defined, and it inherits from the `FirefallOpenAI` class. The `__init__` method is overridden to initialize the Model object. It calls the `__init__` method of the parent class, passing the `config` parameter. It also sets various attributes of the Model object based on the configuration settings from the `conf` module.The `Utils` class is instantiated as `util`. This class provides utility methods for reading files.The `ddl_list` attribute is initialized with a list containing the contents of SQL files read using the `util.read_files` method from the "ddl" directory.The `doc_list` attribute is initialized with a list containing the contents of text files read using the `util.read_files` method from the "documentation" directory.The `sql_qa_list` attribute is initialized with a list containing the contents of JSON files read using the `util.read_files` method from the "queries" directory.The `ask` method takes a `question` parameter and prints the question. It then generates an SQL query using the `qa.generate_sql` method from the `qa_base` module, passing the question and the Model object itself. The generated query is stored in the `query` variable.The `qa.run_sql` method is called with the generated query and the Model object to execute the query and retrieve the results as a DataFrame. The DataFrame is stored in the `df` variable.The `qa.generate_summary` method is called with the question, the Model object, and the DataFrame to generate a summary based on the results. The summary is stored in the `summary` variable.Finally, a formatted string is returned, containing the generated query and the summary.The libraries used in this code are:-`base.qa_base`: It provides base functionality for generating SQL queries, running them, and generating summaries.-`firefall.FirefallOpenAI`: It is a class that provides additional functionality for generating SQL queries, running them, and generating summaries.-`os`: It provides functions for interacting with the operating system, such as reading files.-`utils.Utils`: It is a class that provides utility methods for reading files.-`conf`: It is a module that contains configuration settings for the Model class.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | archive\train.py                  |

</details>
